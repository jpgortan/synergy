<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Appetite Paper - Interactive Briefing</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* Custom Styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
            color: #1F2937;
        }
        .fade-in-up {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in-up.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .global-edit-mode .editable-highlight:hover {
            background-color: rgba(251, 146, 60, 0.1);
            border-radius: 4px;
            cursor: pointer;
        }
        .chart-container {
            height: 320px; /* Default height for charts */
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #F97316;
            cursor: pointer;
            border-radius: 50%;
            margin-top: -8px; /* Centers the thumb on the track */
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #F97316;
            cursor: pointer;
            border-radius: 50%;
        }
        [contenteditable="true"] {
            outline: 2px solid transparent;
            transition: outline 0.2s;
        }
        [contenteditable="true"]:focus {
            outline: 2px solid #F97316;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, memo, useCallback, createContext, useContext } = React;

        // --- DATA & CONFIG ---
        const initialContent = {
            overviewTitle: "A Strategic Roll-up for Market Leadership",
            overviewProse: "<p>Merging Simplicity Loans & Advisory with XXXX a Sydney-based firm represents the first step in a broader strategic consolidation play. Together, the two businesses currently settle approximately $3.25 billion annually. This merger is not just a matter of scale—it is a deliberate and strategic move to position the group as the market leader in commercial broking.</p><p class='pt-4 pb-2'><b>Strategic Scale and Market Influence</b></p><p>The combined business immediately gains increased scale, resulting in stronger negotiating leverage with lenders, suppliers, and service partners. This expanded footprint enhances our buying power and market presence. As a larger and more influential entity, the merged group is better equipped to shape commercial terms, advocate for improved client outcomes, and influence industry standards.</p><p class='pt-4 pb-2'><b>A Platform for Growth and Opportunity</b></p><p>This merger creates an attractive, scalable platform for further growth. Major insurers and commercial stakeholders seeking distribution partners or divestment opportunities will now see a more stable, efficient, and influential partner in the merged group. The operational alignment between the two firms sets the stage for streamlined processes, stronger strategic direction, and an adaptable platform that supports long-term expansion. Importantly, with two additional acquisitions already in motion, commercial volumes are projected to rise to approximately $5 billion annually. This growth will position the group as the largest commercial broker in the Australian market.</p><p class='pt-4 pb-2'><b>Beyond Volume: Efficiency, Talent, and Innovation</b></p><p>This merger is not purely a volume play. It is about building a unified, high-performing, and future-ready business. By consolidating operations, aligning talent, and strengthening brand presence, we are creating a more cohesive and resilient organisation. Leveraging shared data, technology platforms, and collective market expertise, the merged entity will set a new benchmark in client service and operational efficiency. It will foster innovation, streamline delivery, and enhance the client experience across all touchpoints.</p><p class='pt-4 pb-2'><b>Leadership in a Competitive Landscape</b></p><p>In an increasingly competitive and dynamic market, strategic consolidation is key to sustained leadership. This merger is not just about being the biggest—it’s about being the best: in capability, influence, and value creation. By taking this first step, we are building a foundation that will enable us to lead the commercial broking industry into its next era.</p>",
            marketShareTitle: "Strategic Market Leadership",
            marketShareText: "Uniting two of Sydney’s most respected commercial brokers to claim unrivalled market share. This first step in our consolidation journey cements our position as the go-to commercial broker in Australia—backed by scale, reputation, and strategic alignment.",
            innovationTitle: "Innovative Integration",
            innovationText: "Unlocking the future of commercial broking with scale, talent, and technology. By integrating our strengths, we deliver unmatched value to clients through smarter systems, broader expertise, and a unified service experience built for tomorrow.",
            shareholderValueTitle: "Shareholder Value",
            shareholderValueText: "Driving long-term returns through operational excellence and strategic scale. This merger creates a high-performing platform that delivers meaningful synergies, improves profitability, and accelerates value creation across the group.",
            strategyTitle: "Roadmap to Integration and Value Realisation",
            opportunityTitle: "Re-Rating the Business: Stable Performers to Market Platform",
            opportunityProse: "<p>This merger marks the first deliberate step in consolidating two of Sydney’s most established commercial broking businesses organisations that have independently built strong reputations, loyal client bases, and consistent earnings. On a standalone basis, each firm is currently valued between <b>5 and 7 times EBITDA</b>, reflecting their stable yet siloed positions in the market. However, our ambition goes far beyond status quo.</p><p class='pt-4'>The strategic intent is to create a single, unified business capable of generating in excess of $20 million in annual EBITDA—a figure that is both realistic and attainable through scale, operational alignment, and targeted growth initiatives. A business of this size, influence, and strategic clarity commands a fundamentally different valuation. Industry precedent and investor appetite consistently show that high-performing, market-leading platforms of scale attract multiples in the <b>11 to 12 times EBITDA</b> range.</p><p class='pt-4'>The drivers of this uplift are clear:</p><p><b>Increased Operational Efficiency:</b> Centralised functions, shared infrastructure, and streamlined systems reduce duplication and deliver cost advantages.</p><p><b>Diversified Revenue Streams:</b> Broader client coverage, cross-referral capabilities, and increased product breadth strengthen revenue stability.</p><p><b>Enhanced Strategic Partnerships:</b> A larger client base and deeper market penetration improve our leverage with insurers, lenders, and suppliers.</p><p><b>Institutional Appeal:</b> The merged entity presents a compelling proposition for capital partners or strategic acquirers looking for scalable, profitable distribution platforms.</p><p class='pt-4'>This is not just a merger—it is the beginning of a broader industry consolidation play, with this transaction serving as the anchor platform. The aim is to build an enterprise that leads on every front: scale, innovation, service, and profitability.</p>",
            marketRationaleTitle: "The Strategic Rationale",
            marketRationale: "Commercial broking is a fragmented industry, traditionally driven by founder-led firms operating in isolation. While many have built successful businesses, the lack of scale limits their ability to influence the market and capture enterprise value. This merger is a proactive step towards shaping a dominant, scalable platform that redefines the landscape. For founding partners, it represents a unique opportunity to create generational value, participate in something market-changing, and help lead the next era of growth.",
            financialOfferTitle: "Flexibility for Founders",
            financialOffer: "Founding members will participate in the merged group via a consistent and transparent valuation methodology based on EBITDA multiples. A two-stage equity process includes a true-up mechanism at the end of Year 2, aligning incentives around growth. Shareholding flexibility allows members to contribute all or part of their business, with options to maintain involvement or pursue a structured exit. This model ensures fairness while supporting entrepreneurial continuity.",
            businessSupportTitle: "Tailored Support Performance",
            businessSupport: "Founders will gain access to a suite of optional business support services designed to accelerate performance and relieve operational burden. This includes access to proven tech platforms, compliance infrastructure, client engagement tools, and prospecting capabilities. Services are modular and fee-based, ensuring alignment and accountability. The only non-negotiable requirement is continued adherence to high-quality deal standards—critical for maintaining lender confidence.",
            valueRealisationTitle: "Value Through Scale",
            valueRealisation: "As a larger, unified group, we gain unprecedented scale in lender negotiations. This opens doors to white-label offerings, tailored product development, and exclusive commercial terms. By aggregating volume and standardising deal quality, the group becomes a preferred channel partner for banks and non-banks alike. Uplift in revenue from these enhanced partnerships will contribute to true-up payments and support ongoing enterprise value growth.",
            shareholdingCalculatorTitle: "Shareholding Calculator",
            teamTitle: "A Foundation of Excellence",
            supportingDocsTitle: "Supporting Documents"
        };
        
        const initialTimelineData = [
            { id: 1, time: "2025-10-01", title: "Merger of HeadCo", description: "Merger of the HeadCo entity — the foundation of the group and strategic consolidation platform." },
            { id: 2, time: "2026-02-01", title: "Integration of Entity 2", description: "Integration of Entity 2 — expanding scale and broadening market presence." },
            { id: 3, time: "2026-04-01", title: "Integration of Entity 3", description: "Integration of Entity 3 — rounding out the initial platform and establishing national leadership." },
            { id: 4, time: "Day 1", title: "Financial Integration", description: "Financial integration to unify accounting, performance monitoring, and group reporting." },
            { id: 5, time: "Day 180", title: "Tech & Product Integration", description: "Technology and product integration to harmonise digital platforms, unlock operating efficiency, and deliver an enhanced client experience." }
        ];
        
        const initialLeadershipTeam = [
            { id: 1, name: 'Stephen Moore', role: 'CEO', bio: "As the former CEO of Choice Aggregation Services, Stephen is a respected industry leader known for driving significant market share growth and advocating for data-driven strategies to enhance broker and client outcomes." },
            { id: 2, name: 'Andrew Steadwell', role: 'CFO', bio: "A seasoned financial executive with extensive experience in large-scale operations and digital transformations, having served as CFO for major publishers like Bauer Media and ACP Magazines." },
            { id: 3, name: 'Jean-Pierre Gortan', role: 'Product & Credit', bio: "An award-winning commercial broker and co-founder of Simplicity Loans & Advisory, JP has over 20 years of expertise in structuring complex commercial, construction, and equipment finance deals." },
            { id: 4, name: 'Ryan Nelson', role: 'General Manager, Operations', bio: "An experienced operations leader focused on implementing scalable systems and processes to drive efficiency and support rapid growth across the consolidated group." },
            { id: 5, name: 'Matthew Johnson', role: 'GM, Finance', bio: "A co-founder of Simplicity Loans & Advisory, Matthew brings deep financial acumen and is responsible for overseeing the financial integration and performance monitoring of the merged entities." },
        ];
        
        const baseCashflowData = {
            initialCash: 23000000,
            mergedCoEBITDA: 1041667,
            merger2EBITDA: 312500,
            merger3EBITDA: 208333,
            initialAcquisitionPayment: -25000000,
            merger2AcquisitionPayment: -15000000,
            merger3AcquisitionPayment: -10000000,
            debtDrawdown: 14062500,
            newStaffCostY1: -70833,
            newStaffCostY2: -88542,
            amortisationY2: -750000,
            interestCostsY1: -105469,
        };
        const initialSupportingDocs = [
            { id: 1, title: "FY2024 Financial Statements", description: "Audited financial statements for the fiscal year 2024.", file: null, url: "#" },
            { id: 2, title: "Market Research Report Q2 2025", description: "In-depth analysis of market trends and competitor landscape.", file: null, url: "#" },
            { id: 3, title: "Due Diligence Checklist", description: "Comprehensive checklist for target acquisitions.", file: null, url: "#" }
        ];

        // --- HOOKS ---
        const useIntersectionObserver = (options) => {
            const [entries, setEntries] = useState([]);
            const observer = useRef(null);
            useEffect(() => {
                observer.current = new IntersectionObserver((observedEntries) => { setEntries(observedEntries); }, options);
                const currentObserver = observer.current;
                return () => { if (currentObserver) currentObserver.disconnect(); };
            }, [options]);
            return [observer.current, entries];
        };
        
        const useScrollFadeIn = () => {
            const [observer, entries] = useIntersectionObserver({ threshold: 0.1 });
            useEffect(() => {
                const elements = document.querySelectorAll('.fade-in-up');
                if (observer) elements.forEach(el => observer.observe(el));
                return () => { if (observer) elements.forEach(el => observer.unobserve(el)); };
            }, [observer]);
            useEffect(() => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('is-visible'); });
            }, [entries]);
        };

        // --- COMPONENTS ---
        const AppContext = createContext();

        const FloatingToolbar = ({ isVisible, position, onFormat }) => {
            if (!isVisible) return null;
            const handleFormat = (e, command) => {
                e.preventDefault(); 
                onFormat(command);
            };
            return (
                <div
                    className="absolute z-50 bg-gray-800 text-white rounded-md shadow-lg flex items-center p-1"
                    style={{ left: position.x, top: position.y }}
                    onMouseDown={e => e.preventDefault()}
                >
                    <button onClick={(e) => handleFormat(e, 'bold')} className="p-2 hover:bg-gray-700 rounded font-bold">B</button>
                    <button onClick={(e) => handleFormat(e, 'italic')} className="p-2 hover:bg-gray-700 rounded italic">I</button>
                </div>
            );
        };
        
        const RichTextEditor = ({ contentKey, value, onSave, className }) => {
            const { isGlobalEditMode } = useContext(AppContext);
            const editorRef = useRef(null);
            const [toolbarState, setToolbarState] = useState({ isVisible: false, position: { x: 0, y: 0 } });
            const handleMouseUp = () => {
                if (!isGlobalEditMode) return;
                setTimeout(() => {
                    const selection = window.getSelection();
                    if (selection && !selection.isCollapsed) {
                        const range = selection.getRangeAt(0);
                        const rect = range.getBoundingClientRect();
                        setToolbarState({
                            isVisible: true,
                            position: {
                                x: rect.left + window.scrollX + (rect.width / 2) - 32,
                                y: rect.top + window.scrollY - 40,
                            },
                        });
                    } else {
                        setToolbarState({ isVisible: false, position: { x: 0, y: 0 } });
                    }
                }, 10);
            };
            const handleBlur = () => {
                if (editorRef.current) {
                    onSave(contentKey, editorRef.current.innerHTML);
                }
                setTimeout(() => setToolbarState(prev => ({ ...prev, isVisible: false })), 200);
            };
            const handleFormat = (command) => {
                document.execCommand(command, false, null);
                editorRef.current.focus();
            };
            return (
                <div className="relative" onMouseUp={handleMouseUp}>
                    <FloatingToolbar
                        isVisible={toolbarState.isVisible}
                        position={toolbarState.position}
                        onFormat={handleFormat}
                    />
                    <div
                        ref={editorRef}
                        contentEditable={isGlobalEditMode}
                        onBlur={handleBlur}
                        dangerouslySetInnerHTML={{ __html: value }}
                        className={`${className} ${isGlobalEditMode ? 'p-2 bg-orange-50 border border-orange-200 rounded-md' : ''} editable-highlight whitespace-normal`}
                    />
                </div>
            );
        };

        const ChartComponent = memo(({ type, data, options }) => {
            const canvasRef = useRef(null);
            useEffect(() => {
                if (!canvasRef.current) return;
                const chart = new Chart(canvasRef.current, { type, data, options });
                return () => chart.destroy();
            }, [type, data, options]);
            return <canvas ref={canvasRef}></canvas>;
        });

        const IntroScreen = ({ onLaunch }) => {
            const [headline, setHeadline] = useState('');
            useEffect(() => {
                let i = 0;
                const fullText = "Project Synergy";
                const interval = setInterval(() => {
                    if (i < fullText.length) {
                        setHeadline(prev => prev + fullText.charAt(i++));
                    } else {
                        clearInterval(interval);
                    }
                }, 100);
                return () => clearInterval(interval);
            }, []);
            return (
                <div className="fixed inset-0 bg-gray-50 flex flex-col items-center justify-center z-50 p-4">
                    <div className="text-center">
                        <h1 className="text-4xl md:text-7xl font-black text-gray-900 mb-4 min-h-[84px] md:min-h-[144px]">{headline}</h1>
                        <p className="text-lg md:text-xl text-gray-500 mb-8">A confidential interactive transaction briefing document.</p>
                        <button onClick={onLaunch} className="bg-[#F97316] text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-900 transition-all transform hover:scale-105">View Briefing</button>
                    </div>
                </div>
            );
        };

        const PasswordGate = ({ onAuthenticated }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState(false);
            const handleSubmit = (e) => {
                e.preventDefault();
                if (password === 'synergy2025') onAuthenticated();
                else setError(true);
            };
            return (
                <div className="fixed inset-0 bg-gray-900/50 backdrop-blur-md flex items-center justify-center z-50">
                    <div className="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm">
                        <h2 className="text-2xl font-bold text-center mb-2 text-gray-900">Project Synergy</h2>
                        <p className="text-center text-gray-500 mb-6">Access Restricted</p>
                        <form onSubmit={handleSubmit}>
                            <input type="password" value={password} onChange={(e) => { setPassword(e.target.value); setError(false); }} className={`w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 ${error ? 'border-red-500 focus:ring-red-500' : 'border-gray-300 focus:ring-[#F97316]'}`} placeholder="Enter Password" />
                            {error && <p className="text-red-500 text-sm mt-2">Incorrect password. Please try again.</p>}
                            <button type="submit" className="w-full bg-[#F97316] text-white font-bold py-2 px-4 rounded-md mt-4 hover:bg-gray-900 transition-colors">Authenticate</button>
                        </form>
                    </div>
                </div>
            );
        };
        
        const EditModePasswordGate = ({ onAuthenticated, onCancel }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState(false);
            const passwordRef = useRef(null);
            useEffect(() => {
                if (passwordRef.current) {
                    passwordRef.current.focus();
                }
            }, []);
            const handleSubmit = (e) => {
                e.preventDefault();
                if (password === 'edit2025') {
                    onAuthenticated();
                } else {
                    setError(true);
                    setPassword('');
                }
            };
            return (
                <div className="fixed inset-0 bg-gray-900/50 backdrop-blur-md flex items-center justify-center z-50 p-4" onClick={onCancel}>
                    <div className="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold text-center mb-2 text-gray-900">Enter Edit Mode</h2>
                        <p className="text-center text-gray-500 mb-6">Please enter the administrator password.</p>
                        <form onSubmit={handleSubmit}>
                            <input
                                ref={passwordRef}
                                type="password"
                                value={password}
                                onChange={(e) => { setPassword(e.target.value); setError(false); }}
                                className={`w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 ${error ? 'border-red-500 focus:ring-red-500' : 'border-gray-300 focus:ring-[#F97316]'}`}
                                placeholder="Admin Password"
                            />
                            {error && <p className="text-red-500 text-sm mt-2">Incorrect password. Please try again.</p>}
                            <div className="flex justify-end space-x-4 mt-4">
                                 <button type="button" onClick={onCancel} className="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">Cancel</button>
                                 <button type="submit" className="bg-[#F97316] text-white font-bold py-2 px-4 rounded-md hover:bg-gray-900 transition-colors">Authorize</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const Header = ({ activeSection, onDownload, isDownloading, onToggleEditMode, isGlobalEditMode, onShare, shareStatus }) => {
            const navItems = [
                { id: "overview", label: "Overview" },
                { id: "strategy", label: "Strategy" },
                { id: "opportunity", label: "Opportunity" },
                { id: "interactive-financials", label: "Interactive" },
                { id: "shareholding-calculator", label: "Calculator" },
                { id: "team", label: "Team" },
                { id: "supporting-documents", label: "Docs" }
            ];
            return (
                <header id="main-header" className="bg-white/80 backdrop-blur-md sticky top-0 z-40 border-b border-gray-200">
                    <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <h1 className="text-xl font-bold text-gray-900">Project Synergy</h1>
                            <nav className="hidden xl:flex flex-grow items-center justify-center px-8">
                                <div className="flex items-center space-x-1 bg-gray-200 p-1 rounded-full w-full max-w-5xl">
                                    {navItems.map(item => (
                                        <a
                                            key={item.id}
                                            href={`#${item.id}`}
                                            className={`
                                                flex-1 text-center text-xs font-semibold capitalize rounded-full py-1.5 px-3
                                                transition-all duration-200 ease-in-out
                                                ${activeSection === item.id
                                                    ? 'bg-orange-600 text-white shadow-sm'
                                                    : 'text-gray-600 hover:bg-white/60'
                                                }
                                            `}
                                        >
                                            {item.label}
                                        </a>
                                    ))}
                                </div>
                            </nav>
                            <div className="flex items-center space-x-2 ml-4">
                                <div className="relative">
                                    <button onClick={onShare} className="font-bold py-2 px-4 rounded-full text-sm transition-colors bg-gray-600 text-white hover:bg-gray-700">
                                        Share
                                    </button>
                                    {shareStatus && <span className="absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">{shareStatus}</span>}
                                </div>
                                <div className="flex items-center space-x-2">
                                    <span className="text-sm font-medium text-gray-600">Edit</span>
                                    <button
                                        onClick={onToggleEditMode}
                                        className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-300 ${isGlobalEditMode ? 'bg-orange-600' : 'bg-gray-300'}`}
                                    >
                                        <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-300 ${isGlobalEditMode ? 'translate-x-6' : 'translate-x-1'}`} />
                                    </button>
                                </div>
                                <button
                                    id="download-pdf-btn"
                                    onClick={onDownload}
                                    disabled={isDownloading}
                                    className="bg-orange-500 text-white font-bold py-2 px-4 rounded-full text-sm hover:bg-orange-600 disabled:bg-gray-400 transition-colors"
                                >
                                    {isDownloading ? '...' : 'PDF'}
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        const Section = ({ id, children, className = '', style }) => <section id={id} className={`mb-24 scroll-mt-24 ${className}`} style={style}>{children}</section>;

        const TimelineEditorModal = ({ isOpen, onClose, onSave, data }) => {
            const [localData, setLocalData] = useState([]);
            useEffect(() => {
                setLocalData(JSON.parse(JSON.stringify(data)));
            }, [data]);
            if (!isOpen) return null;
            const handleFieldChange = (index, field, value) => {
                const updatedData = [...localData];
                updatedData[index][field] = value;
                setLocalData(updatedData);
            };
            const addMilestone = () => {
                setLocalData([...localData, { id: Date.now(), time: '', title: '', description: '' }]);
            };
            const deleteMilestone = (index) => {
                const updatedData = [...localData];
                updatedData.splice(index, 1);
                setLocalData(updatedData);
            };
            const handleSave = () => {
                onSave(localData);
                onClose();
            };
            return (
                <div className="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-white p-6 md:p-8 rounded-lg shadow-2xl w-full max-w-4xl" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold text-gray-900 mb-6">Edit Timeline Milestones</h2>
                        <div className="space-y-4 max-h-[60vh] overflow-y-auto pr-4">
                            {localData.map((milestone, index) => (
                                <div key={milestone.id} className="grid grid-cols-1 md:grid-cols-12 gap-4 items-start p-4 border rounded-lg">
                                    <div className="md:col-span-3">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Date / Time</label>
                                        <input type="text" value={milestone.time} onChange={(e) => handleFieldChange(index, 'time', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md"/>
                                    </div>
                                    <div className="md:col-span-3">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Event / Title</label>
                                        <input type="text" value={milestone.title} onChange={(e) => handleFieldChange(index, 'title', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md"/>
                                    </div>
                                    <div className="md:col-span-5">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <textarea value={milestone.description} onChange={(e) => handleFieldChange(index, 'description', e.target.value)} rows="2" className="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                                    </div>
                                    <div className="md:col-span-1 flex items-end justify-end">
                                        <button onClick={() => deleteMilestone(index)} className="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 mt-6">
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                         <button onClick={addMilestone} className="mt-4 bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-600 transition-colors">Add Milestone</button>
                        <div className="flex justify-end space-x-4 mt-8">
                            <button onClick={onClose} className="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">Cancel</button>
                            <button onClick={handleSave} className="bg-orange-500 text-white font-bold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors">Save Changes</button>
                        </div>
                    </div>
                </div>
            );
        };
        const TeamEditorModal = ({ isOpen, onClose, onSave, data }) => {
            const [localData, setLocalData] = useState([]);
            useEffect(() => {
                setLocalData(JSON.parse(JSON.stringify(data)));
            }, [data]);
            if (!isOpen) return null;
            const handleFieldChange = (index, field, value) => {
                const updatedData = [...localData];
                updatedData[index][field] = value;
                setLocalData(updatedData);
            };
            const addMember = () => {
                setLocalData([...localData, { id: Date.now(), name: '', role: '', bio: '' }]);
            };
            const deleteMember = (index) => {
                const updatedData = [...localData];
                updatedData.splice(index, 1);
                setLocalData(updatedData);
            };
            const handleSave = () => {
                onSave(localData);
                onClose();
            };
            return (
                <div className="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-white p-6 md:p-8 rounded-lg shadow-2xl w-full max-w-4xl" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold text-gray-900 mb-6">Edit Team Members</h2>
                        <div className="space-y-4 max-h-[60vh] overflow-y-auto pr-4">
                            {localData.map((member, index) => (
                                <div key={member.id} className="grid grid-cols-1 md:grid-cols-12 gap-4 items-start p-4 border rounded-lg">
                                    <div className="md:col-span-3">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                        <input type="text" value={member.name} onChange={(e) => handleFieldChange(index, 'name', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md"/>
                                    </div>
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Role</label>
                                        <input type="text" value={member.role} onChange={(e) => handleFieldChange(index, 'role', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md"/>
                                    </div>
                                    <div className="md:col-span-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Key Information / CV</label>
                                        <textarea value={member.bio} onChange={(e) => handleFieldChange(index, 'bio', e.target.value)} rows="2" className="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                                    </div>
                                    <div className="md:col-span-1 flex items-end justify-end">
                                        <button onClick={() => deleteMember(index)} className="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 mt-6">
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                         <button onClick={addMember} className="mt-4 bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-600 transition-colors">Add Member</button>
                        <div className="flex justify-end space-x-4 mt-8">
                            <button onClick={onClose} className="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">Cancel</button>
                            <button onClick={handleSave} className="bg-orange-500 text-white font-bold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors">Save Changes</button>
                        </div>
                    </div>
                </div>
            );
        };
        const SupportingDocsEditorModal = ({ isOpen, onClose, onSave, data }) => {
            const [localData, setLocalData] = useState([]);
            useEffect(() => {
                setLocalData(JSON.parse(JSON.stringify(data)));
            }, [data]);
            if (!isOpen) return null;
            const handleFieldChange = (index, field, value) => {
                const updatedData = [...localData];
                updatedData[index][field] = value;
                setLocalData(updatedData);
            };
            const handleFileChange = (index, file) => {
                const updatedData = [...localData];
                if (updatedData[index].url && updatedData[index].url.startsWith('blob:')) {
                    URL.revokeObjectURL(updatedData[index].url);
                }
                updatedData[index].file = file;
                updatedData[index].url = file ? URL.createObjectURL(file) : "#";
                setLocalData(updatedData);
            };
            const addDoc = () => {
                setLocalData([...localData, { id: Date.now(), title: '', description: '', file: null, url: '#' }]);
            };
            const deleteDoc = (index) => {
                const updatedData = [...localData];
                if (updatedData[index].url && updatedData[index].url.startsWith('blob:')) {
                    URL.revokeObjectURL(updatedData[index].url);
                }
                updatedData.splice(index, 1);
                setLocalData(updatedData);
            };
            const handleSave = () => {
                onSave(localData);
                onClose();
            };
            return (
                <div className="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-white p-6 md:p-8 rounded-lg shadow-2xl w-full max-w-4xl" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold text-gray-900 mb-6">Edit Supporting Documents</h2>
                        <div className="space-y-4 max-h-[60vh] overflow-y-auto pr-4">
                            {localData.map((doc, index) => (
                                <div key={doc.id} className="grid grid-cols-1 md:grid-cols-12 gap-4 items-start p-4 border rounded-lg">
                                    <div className="md:col-span-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Document Title</label>
                                        <input type="text" value={doc.title} onChange={(e) => handleFieldChange(index, 'title', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md"/>
                                    </div>
                                    <div className="md:col-span-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <input type="text" value={doc.description} onChange={(e) => handleFieldChange(index, 'description', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md"/>
                                    </div>
                                    <div className="md:col-span-3">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Upload File</label>
                                        <div className="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                                            <div className="space-y-1 text-center">
                                                <svg className="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" /></svg>
                                                <div className="flex text-sm text-gray-600">
                                                    <label htmlFor={`file-upload-${doc.id}`} className="relative cursor-pointer bg-white rounded-md font-medium text-orange-600 hover:text-orange-500 focus-within:outline-none">
                                                        <span>Upload a file</span>
                                                        <input id={`file-upload-${doc.id}`} name="file-upload" type="file" className="sr-only" onChange={(e) => handleFileChange(index, e.target.files[0])} />
                                                    </label>
                                                    <p className="pl-1">or drag and drop</p>
                                                </div>
                                                <p className="text-xs text-gray-500">{doc.file ? doc.file.name : 'No file chosen'}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="md:col-span-1 flex items-end justify-end">
                                        <button onClick={() => deleteDoc(index)} className="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 mt-6">
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                         <button onClick={addDoc} className="mt-4 bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-600 transition-colors">Add Document</button>
                        <div className="flex justify-end space-x-4 mt-8">
                            <button onClick={onClose} className="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">Cancel</button>
                            <button onClick={handleSave} className="bg-orange-500 text-white font-bold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors">Save Changes</button>
                        </div>
                    </div>
                </div>
            );
        };
        const ProfitabilityModal = ({ isOpen, onClose, data }) => {
            if (!isOpen) return null;
            const formatCurrency = (value) => new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
            return (
                <div className="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-white p-6 md:p-8 rounded-lg shadow-2xl w-full max-w-lg text-gray-800" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900">Annual Profitability Summary</h2>
                                <p className="text-gray-600">This is a 12-month projection starting from <span className="font-bold">Month {data.startMonth}</span>.</p>
                            </div>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-800 text-3xl leading-none">&times;</button>
                        </div>
                        <div className="space-y-3">
                            <div className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                <span className="font-semibold">Total EBITDA</span>
                                <span className="font-mono text-lg">{formatCurrency(data.totalEBITDA)}</span>
                            </div>
                            <div className="flex justify-between items-center p-3">
                                <span className="font-semibold text-sm">Total Debt Interest</span>
                                <span className={`font-mono ${data.totalDebtInterest < 0 ? 'text-red-600' : ''}`}>{formatCurrency(data.totalDebtInterest)}</span>
                            </div>
                            <div className="flex justify-between items-center p-3">
                                <span className="font-semibold text-sm">Total New Staff Costs</span>
                                <span className={`font-mono ${data.totalNewStaffCosts < 0 ? 'text-red-600' : ''}`}>{formatCurrency(data.totalNewStaffCosts)}</span>
                            </div>
                            <div className="flex justify-between items-center p-3">
                                <span className="font-semibold text-sm">Total Amortisation</span>
                                <span className={`font-mono ${data.totalAmortisation < 0 ? 'text-red-600' : ''}`}>{formatCurrency(data.totalAmortisation)}</span>
                            </div>
                            <div className="flex justify-between items-center p-3">
                                <span className="font-semibold text-sm">Total Dividends</span>
                                <span className={`font-mono ${data.totalDividends < 0 ? 'text-red-600' : ''}`}>{formatCurrency(data.totalDividends)}</span>
                            </div>
                            <div className="flex justify-between items-center p-4 bg-gray-100 border-t-2 border-gray-200 rounded-b-md mt-4">
                                <span className="font-bold text-xl">Projected Net Cash Flow</span>
                                <span className={`font-mono text-xl font-bold ${data.netCashFlow < 0 ? 'text-red-600' : 'text-green-600'}`}>{formatCurrency(data.netCashFlow)}</span>
                            </div>
                        </div>
                        <button onClick={onClose} className="w-full bg-[#F97316] text-white font-bold py-2 px-4 rounded-md mt-6 hover:bg-gray-900 transition-colors">Close</button>
                    </div>
                </div>
            );
        };

        const InteractiveFinancials = () => {
            const [monthlyGrowth, setMonthlyGrowth] = useState(0.5);
            const [equityDrawdown, setEquityDrawdown] = useState(23000000);
            const [debtDrawdown, setDebtDrawdown] = useState(14062500);
            const [interestRate, setInterestRate] = useState(9);
            const [merger2AcqMonth, setMerger2AcqMonth] = useState(4);
            const [merger3AcqMonth, setMerger3AcqMonth] = useState(5);
            const [modalData, setModalData] = useState(null);
            const [modalError, setModalError] = useState('');

            const cashflow = useMemo(() => {
                const results = [];
                let openingBalance = equityDrawdown;
                let debtBalance = 0;

                for (let i = 1; i <= 24; i++) {
                    const row = {};
                    row.month = i;
                    row.openingBalance = openingBalance;
                    
                    const growthMultiplier = Math.pow(1 + monthlyGrowth / 100, i - 1);
                    row.mergedCoEBITDA = baseCashflowData.mergedCoEBITDA * growthMultiplier;
                    row.merger2EBITDA = (i >= merger2AcqMonth) ? baseCashflowData.merger2EBITDA * Math.pow(1 + monthlyGrowth / 100, i - merger2AcqMonth) : 0;
                    row.merger3EBITDA = (i >= merger3AcqMonth) ? baseCashflowData.merger3EBITDA * Math.pow(1 + monthlyGrowth / 100, i - merger3AcqMonth) : 0;
                    row.totalEBITDA = row.mergedCoEBITDA + row.merger2EBITDA + row.merger3EBITDA;
                    
                    row.debtDrawdown = (i === 1) ? debtDrawdown : 0;
                    
                    const prevDebtBalance = i === 1 ? 0 : results[i-2].debtBalance;
                    
                    row.acquisitionPayments = 
                        (i === 1 ? baseCashflowData.initialAcquisitionPayment : 0) +
                        (i === merger2AcqMonth ? baseCashflowData.merger2AcquisitionPayment : 0) +
                        (i === merger3AcqMonth ? baseCashflowData.merger3AcquisitionPayment : 0);
                    
                    row.debtBalance = prevDebtBalance + row.debtDrawdown;

                    row.amortisation = (i > 12) ? baseCashflowData.amortisationY2 : 0;
                    row.interestCosts = i <= 12 ? baseCashflowData.interestCostsY1 : -((row.debtBalance * (interestRate / 100)) / 12);
                    row.newStaff = i <= 12 ? baseCashflowData.newStaffCostY1 : baseCashflowData.newStaffCostY2;
                    
                    row.netCashFlow = row.totalEBITDA + row.debtDrawdown + row.acquisitionPayments + row.amortisation + row.interestCosts + row.newStaff;
                    row.dividends = 0; // As per sheet
                    
                    row.closingBalance = row.openingBalance + row.netCashFlow;
                    openingBalance = row.closingBalance;
                    results.push(row);
                }
                return results;
            }, [monthlyGrowth, equityDrawdown, debtDrawdown, interestRate, merger2AcqMonth, merger3AcqMonth]);

            const handleMonthClick = (monthIndex) => {
                const relevantMonths = cashflow.slice(monthIndex, monthIndex + 12);
                if (relevantMonths.length < 12) {
                    setModalError("Not enough data for a full 12-month projection from this month.");
                    setTimeout(() => setModalError(''), 3000);
                    return;
                };
                const calculateTotal = (key) => relevantMonths.reduce((sum, month) => sum + month[key], 0);
                
                setModalData({ 
                    startMonth: monthIndex + 1, 
                    totalEBITDA: calculateTotal('totalEBITDA'),
                    totalDebtInterest: calculateTotal('interestCosts'),
                    totalNewStaffCosts: calculateTotal('newStaff'),
                    totalAmortisation: calculateTotal('amortisation'),
                    totalDividends: calculateTotal('dividends'),
                    netCashFlow: calculateTotal('netCashFlow')
                });
            };

            const formatCurrency = (value) => new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
            
            const rowHeaders = {
                openingBalance: "Opening Balance",
                mergedCoEBITDA: "Merged Co EBITDA",
                merger2EBITDA: "Merger 2 EBITDA",
                merger3EBITDA: "Merger 3 EBITDA",
                totalEBITDA: "Total EBITDA",
                debtDrawdown: "Debt Drawdown",
                debtBalance: "Debt Balance",
                acquisitionPayments: "Acquisition Payments",
                amortisation: "Amortisation",
                interestCosts: "Interest Costs",
                newStaff: "New Staff",
                netCashFlow: "Net Cashflow",
                dividends: "Dividends",
                closingBalance: "Closing Balance"
            };

            return (
                <Section id="interactive-financials" className="container mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 className="text-4xl md:text-5xl font-bold text-center mb-4 fade-in-up">Interactive Financials</h2>
                    <p className="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-16 fade-in-up" style={{ transitionDelay: '100ms' }}>Adjust the sliders to model different scenarios and see the immediate impact on the 24-month cashflow projection. Click on a month's header for an annual profitability summary.</p>
                    <div className="bg-white border border-gray-200 rounded-lg p-6 md:p-8 fade-in-up shadow-lg mb-8">
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <div>
                                <label htmlFor="monthlyGrowth" className="font-bold">Monthly Growth: {monthlyGrowth}%</label>
                                <input id="monthlyGrowth" type="range" min="0" max="2" step="0.05" value={monthlyGrowth} onChange={(e) => setMonthlyGrowth(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"/>
                            </div>
                             <div>
                                <label htmlFor="equityDrawdown" className="font-bold">Equity Drawdown: {formatCurrency(equityDrawdown)}</label>
                                <input id="equityDrawdown" type="range" min="15000000" max="30000000" step="100000" value={equityDrawdown} onChange={(e) => setEquityDrawdown(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"/>
                            </div>
                            <div>
                                <label htmlFor="debtDrawdown" className="font-bold">Debt Drawdown: {formatCurrency(debtDrawdown)}</label>
                                <input id="debtDrawdown" type="range" min="10000000" max="20000000" step="100000" value={debtDrawdown} onChange={(e) => setDebtDrawdown(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"/>
                            </div>
                            <div>
                                <label htmlFor="interestRate" className="font-bold">Annual Interest Rate: {interestRate}%</label>
                                <input id="interestRate" type="range" min="0" max="15" value={interestRate} onChange={(e) => setInterestRate(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"/>
                            </div>
                            <div>
                                <label htmlFor="merger2AcqMonth" className="font-bold">Merger 2 Acq. Month: {merger2AcqMonth}</label>
                                <input id="merger2AcqMonth" type="range" min="1" max="12" value={merger2AcqMonth} onChange={(e) => setMerger2AcqMonth(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"/>
                            </div>
                            <div>
                                <label htmlFor="merger3AcqMonth" className="font-bold">Merger 3 Acq. Month: {merger3AcqMonth}</label>
                                <input id="merger3AcqMonth" type="range" min="1" max="12" value={merger3AcqMonth} onChange={(e) => setMerger3AcqMonth(Number(e.target.value))} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"/>
                            </div>
                        </div>
                        {modalError && <div className="mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-center">{modalError}</div>}
                    </div>
                    <div id="cashflow-table-container" className="overflow-x-auto bg-white border border-gray-200 rounded-lg shadow-lg fade-in-up">
                        <table className="w-full text-sm text-left whitespace-nowrap">
                            <thead className="bg-gray-50 text-xs text-gray-700 uppercase">
                                <tr>
                                    <th className="px-4 py-3 sticky left-0 bg-gray-50 z-10">Metric</th>
                                    {cashflow.map(m => (
                                        <th key={m.month} className="px-4 py-3 text-right cursor-pointer hover:bg-gray-200 transition-colors" onClick={() => handleMonthClick(m.month - 1)} title={`Calculate 12-month summary from Month ${m.month}`}>
                                            {`M${m.month}`}
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {Object.keys(rowHeaders).map(key => (
                                    <tr key={key} className="border-b border-gray-200 hover:bg-gray-50">
                                        <td className="px-4 py-2 font-semibold capitalize sticky left-0 bg-white hover:bg-gray-50 z-10">{rowHeaders[key]}</td>
                                        {cashflow.map(m => <td key={`${key}-${m.month}`} className={`px-4 py-2 text-right font-mono ${m[key] < 0 ? 'text-red-600' : 'text-gray-800'}`}>{formatCurrency(m[key])}</td>)}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <ProfitabilityModal isOpen={!!modalData} onClose={() => setModalData(null)} data={modalData} />
                </Section>
            );
        };

        const ShareholdingCalculator = () => {
            const [entities, setEntities] = useState([
                { name: 'Simplicity', ebitda: 6250000, multiple: 8, businessAcquired: 100, considerationShares: 75, sharePrice: 1.00 },
                { name: 'Merge 1', ebitda: 6250000, multiple: 8, businessAcquired: 100, considerationShares: 75, sharePrice: 1.00 },
                { name: 'Merge 2', ebitda: 3750000, multiple: 7, businessAcquired: 100, considerationShares: 50, sharePrice: 1.20 },
                { name: 'Merge 3', ebitda: 2500000, multiple: 7, businessAcquired: 100, considerationShares: 50, sharePrice: 1.25 }
            ]);
            const [equity, setEquity] = useState(23000000);

            const borderColorsPalette = ['border-orange-500', 'border-amber-500', 'border-red-500', 'border-yellow-500'];

            const handleEntityChange = (index, field, value) => {
                const newEntities = [...entities];
                newEntities[index][field] = Number(value);
                setEntities(newEntities);
            };

            const calculations = useMemo(() => {
                const calculatedEntities = entities.map(e => {
                    const valuation = e.ebitda * e.multiple;
                    const equityAcquired = valuation * (e.businessAcquired / 100);
                    const considerationSharesValue = equityAcquired * (e.considerationShares / 100);
                    const considerationCashValue = equityAcquired - considerationSharesValue;
                    const numberOfSharesIssued = considerationSharesValue / (e.sharePrice || 1);
                    return { ...e, valuation, equityAcquired, considerationSharesValue, considerationCashValue, numberOfSharesIssued };
                });

                const equityShares = equity / 1.00;

                const totalSharesFromMergers = calculatedEntities.reduce((sum, e) => sum + e.numberOfSharesIssued, 0);
                const totalNumberOfShares = totalSharesFromMergers + equityShares;
                
                const output = calculatedEntities.map(e => ({
                    name: e.name,
                    shareholdingValue: e.considerationSharesValue,
                    shareholdingPercent: totalNumberOfShares > 0 ? (e.numberOfSharesIssued / totalNumberOfShares) * 100 : 0,
                }));
                
                output.push({
                    name: 'Equity',
                    shareholdingValue: equity,
                    shareholdingPercent: totalNumberOfShares > 0 ? (equityShares / totalNumberOfShares) * 100 : 0,
                });

                return { calculatedEntities, output };
            }, [entities, equity]);

            const formatCurrency = (value) => new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);

            return (
                <Section id="shareholding-calculator">
                    <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 className="text-4xl md:text-5xl font-bold text-center mb-16 fade-in-up">Shareholding Calculator</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-8">
                            {calculations.calculatedEntities.map((entity, index) => (
                                <div key={entity.name} className={`bg-white p-6 rounded-lg shadow-lg fade-in-up border-t-4 ${borderColorsPalette[index]}`}>
                                    <h3 className="text-2xl font-bold text-center mb-4">{entity.name}</h3>
                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center">
                                            <label className="text-sm font-medium text-gray-700">EBITDA Forecasted</label>
                                            <input type="number" value={entity.ebitda} onChange={e => handleEntityChange(index, 'ebitda', e.target.value)} className="w-1/2 p-1 border rounded text-right" />
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <label className="text-sm font-medium text-gray-700">Multiple</label>
                                            <input type="number" value={entity.multiple} onChange={e => handleEntityChange(index, 'multiple', e.target.value)} className="w-1/2 p-1 border rounded text-right" />
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <label className="text-sm font-medium text-gray-700">% of Business Acquired</label>
                                            <input type="number" value={entity.businessAcquired} onChange={e => handleEntityChange(index, 'businessAcquired', e.target.value)} className="w-1/2 p-1 border rounded text-right" />
                                        </div>
                                         <div className="flex justify-between items-center">
                                            <label className="text-sm font-medium text-gray-700">Consideration Shares %</label>
                                            <input type="number" value={entity.considerationShares} onChange={e => handleEntityChange(index, 'considerationShares', e.target.value)} className="w-1/2 p-1 border rounded text-right" />
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <label className="text-sm font-medium text-gray-700">Share Price</label>
                                            <input type="number" step="0.01" value={entity.sharePrice} onChange={e => handleEntityChange(index, 'sharePrice', e.target.value)} className="w-1/2 p-1 border rounded text-right" />
                                        </div>
                                        <div className="border-t pt-4 mt-4 space-y-2">
                                            <div className="flex justify-between"><span>Valuation:</span> <span className="font-mono">{formatCurrency(entity.valuation)}</span></div>
                                            <div className="flex justify-between"><span>Equity Acquired:</span> <span className="font-mono">{formatCurrency(entity.equityAcquired)}</span></div>
                                            <div className="flex justify-between"><span>Consideration Cash:</span> <span className="font-mono">{formatCurrency(entity.considerationCashValue)}</span></div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="mt-8 bg-white p-6 rounded-lg shadow-lg fade-in-up max-w-md mx-auto">
                            <h3 className="text-2xl font-bold text-center mb-4">Output Shareholding</h3>
                            <table className="w-full">
                               <thead className="bg-gray-100">
                                   <tr className="text-left font-semibold text-gray-600 border-b-2 border-gray-300">
                                       <th className="p-3">Entity</th>
                                       <th className="p-3 text-right">Shareholding %</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   {calculations.output.map((item, index) => (
                                       <tr key={item.name} className={`border-b border-gray-200 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} ${item.name === 'Equity' ? 'font-bold' : ''}`}>
                                           <td className="p-3">{item.name}</td>
                                           <td className="p-3 text-right font-mono">{item.shareholdingPercent.toFixed(2)}%</td>
                                       </tr>
                                   ))}
                               </tbody>
                            </table>
                        </div>
                    </div>
                </Section>
            );
        };
        
        const App = () => {
            const [appState, setAppState] = useState('intro');
            const [activeSection, setActiveSection] = useState('overview');
            const [isDownloading, setIsDownloading] = useState(false);
            const [isGlobalEditMode, setIsGlobalEditMode] = useState(false);
            const [isEditAuthVisible, setIsEditAuthVisible] = useState(false);
            const [shareStatus, setShareStatus] = useState('');
            
            const [textContent, setTextContent] = useState(initialContent);
            const [leadershipTeam, setLeadershipTeam] = useState(initialLeadershipTeam);
            const [timelineData, setTimelineData] = useState(initialTimelineData);
            const [supportingDocs, setSupportingDocs] = useState(initialSupportingDocs);

            const [isTimelineModalOpen, setIsTimelineModalOpen] = useState(false);
            const [isTeamModalOpen, setIsTeamModalOpen] = useState(false);
            const [isDocsModalOpen, setIsDocsModalOpen] = useState(false);

            useScrollFadeIn();

            const handleContentSave = (key, newValue) => setTextContent(prev => ({ ...prev, [key]: newValue }));
            const handleSaveTimeline = (newTimelineData) => setTimelineData(newTimelineData);
            const handleSaveTeam = (newTeamData) => setLeadershipTeam(newTeamData);
            const handleSaveDocs = (newDocsData) => setSupportingDocs(newDocsData);
            
            const handleToggleEditMode = () => {
                if (isGlobalEditMode) {
                    setIsGlobalEditMode(false);
                } else {
                    setIsEditAuthVisible(true);
                }
            };

            const handleEditAuthSuccess = () => {
                setIsGlobalEditMode(true);
                setIsEditAuthVisible(false);
            };
            
            const handleShare = () => {
                const url = window.location.href;
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(url).then(() => {
                        setShareStatus('Copied!');
                    }, () => {
                        setShareStatus('Failed!');
                    });
                } else {
                    const textArea = document.createElement("textarea");
                    textArea.value = url;
                    textArea.style.position = "fixed"; 
                    textArea.style.left = "-9999px";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        setShareStatus('Copied!');
                    } catch (err) {
                        setShareStatus('Failed!');
                    }
                    document.body.removeChild(textArea);
                }
                setTimeout(() => setShareStatus(''), 2000);
            };
            
            const stripHtml = (html) => {
                const doc = new DOMParser().parseFromString(html, 'text/html');
                return doc.body.textContent || "";
            }

            const handleDownloadPDF = async () => {
                setIsDownloading(true);
                await new Promise(resolve => setTimeout(resolve, 100));

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                
                const content = document.getElementById('main-content');
                
                await html2canvas(content, {
                    scale: 2,
                    useCORS: true,
                    windowWidth: content.scrollWidth,
                    windowHeight: content.scrollHeight
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    const canvasWidth = canvas.width;
                    const canvasHeight = canvas.height;
                    const ratio = canvasWidth / canvasHeight;
                    const imgWidth = pageWidth;
                    const imgHeight = imgWidth / ratio;
                    
                    let heightLeft = imgHeight;
                    let position = 0;

                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft > 0) {
                        position = heightLeft - imgHeight;
                        doc.addPage();
                        doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    doc.save('Project-Synergy-Briefing.pdf');
                });

                setIsDownloading(false);
            };

            useEffect(() => {
                if (appState === 'main') {
                    const observer = new IntersectionObserver(
                        (entries) => {
                            const intersectingEntries = entries.filter(e => e.isIntersecting);
                            if (intersectingEntries.length > 0) {
                                intersectingEntries.sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top);
                                setActiveSection(intersectingEntries[0].target.id);
                            }
                        },
                        {
                            threshold: 0.1,
                            rootMargin: "-100px 0px -50% 0px"
                        }
                    );
                    const sections = document.querySelectorAll('section');
                    sections.forEach(section => observer.observe(section));
                    return () => {
                        sections.forEach(section => observer.unobserve(section));
                    };
                }
            }, [appState]);

            if (appState === 'intro') {
                return <IntroScreen onLaunch={() => setAppState('auth')} />;
            }
            if (appState === 'auth') {
                return <PasswordGate onAuthenticated={() => setAppState('main')} />;
            }

            return (
                <AppContext.Provider value={{ isGlobalEditMode }}>
                    <div className={isGlobalEditMode ? 'global-edit-mode' : ''}>
                         <Header 
                            activeSection={activeSection} 
                            onDownload={handleDownloadPDF} 
                            isDownloading={isDownloading} 
                            onToggleEditMode={handleToggleEditMode} 
                            isGlobalEditMode={isGlobalEditMode}
                            onShare={handleShare}
                            shareStatus={shareStatus}
                        />
                        <div id="main-content">
                            <main>
                                <Section id="overview" className="py-20 bg-gray-50">
                                    <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                                        <RichTextEditor contentKey="overviewTitle" value={textContent.overviewTitle} onSave={handleContentSave} className="text-4xl md:text-5xl font-bold mb-4 fade-in-up text-gray-900 text-center" />
                                        <div className="text-lg text-gray-600 mb-16 fade-in-up max-w-7xl mx-auto" style={{ transitionDelay: '100ms' }}>
                                            <RichTextEditor contentKey="overviewProse" value={textContent.overviewProse} onSave={handleContentSave} className="text-left" />
                                        </div>
                                        <div className="grid md:grid-cols-3 gap-8 text-center max-w-6xl mx-auto">
                                            <div className="bg-white border border-gray-200 p-8 rounded-lg fade-in-up shadow-sm" style={{ transitionDelay: '200ms' }}>
                                                <RichTextEditor contentKey="marketShareTitle" value={textContent.marketShareTitle} onSave={handleContentSave} className="text-2xl font-bold text-[#F97316] mb-3 text-center" />
                                                <RichTextEditor contentKey="marketShareText" value={textContent.marketShareText} onSave={handleContentSave} className="text-gray-600 text-center" />
                                            </div>
                                            <div className="bg-white border border-gray-200 p-8 rounded-lg fade-in-up shadow-sm" style={{ transitionDelay: '300ms' }}>
                                                <RichTextEditor contentKey="innovationTitle" value={textContent.innovationTitle} onSave={handleContentSave} className="text-2xl font-bold text-[#F97316] mb-3 text-center" />
                                                <RichTextEditor contentKey="innovationText" value={textContent.innovationText} onSave={handleContentSave} className="text-gray-600 text-center" />
                                            </div>
                                            <div className="bg-white border border-gray-200 p-8 rounded-lg fade-in-up shadow-sm" style={{ transitionDelay: '400ms' }}>
                                                <RichTextEditor contentKey="shareholderValueTitle" value={textContent.shareholderValueTitle} onSave={handleContentSave} className="text-2xl font-bold text-[#F97316] mb-3 text-center" />
                                                <RichTextEditor contentKey="shareholderValueText" value={textContent.shareholderValueText} onSave={handleContentSave} className="text-gray-600 text-center" />
                                            </div>
                                        </div>
                                    </div>
                                </Section>
                                
                                <Section id="strategy" className="container mx-auto px-4 sm:px-6 lg:px-8">
                                    <div className="text-center mb-16">
                                        <RichTextEditor contentKey="strategyTitle" value={textContent.strategyTitle} onSave={handleContentSave} className="text-4xl md:text-5xl font-bold fade-in-up text-center" />
                                        {isGlobalEditMode && (
                                            <button onClick={() => setIsTimelineModalOpen(true)} className="mt-4 bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors inline-block align-middle">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                            </button>
                                        )}
                                    </div>
                                    <div className="fade-in-up max-w-4xl mx-auto">
                                      <ol className="relative border-l border-gray-200">
                                        {timelineData.map((item, index) => (
                                          <li key={item.id} className="mb-10 ml-6">
                                            <span className="absolute flex items-center justify-center w-6 h-6 bg-orange-200 rounded-full -left-3 ring-8 ring-white">
                                              <svg className="w-3 h-3 text-orange-600" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd"></path></svg>
                                            </span>
                                            <h3 className="flex items-center mb-1 text-lg font-semibold text-gray-900">{item.title}</h3>
                                            <time className="block mb-2 text-sm font-normal leading-none text-gray-400">{item.time}</time>
                                            <p className="mb-4 text-base font-normal text-gray-500">{item.description}</p>
                                          </li>
                                        ))}
                                      </ol>
                                    </div>
                                </Section>

                                <Section id="opportunity" className="container mx-auto px-4 sm:px-6 lg:px-8">
                                    <RichTextEditor contentKey="opportunityTitle" value={textContent.opportunityTitle} onSave={handleContentSave} className="text-4xl md:text-5xl font-bold text-center mb-4 fade-in-up" />
                                    <div className="text-lg text-gray-600 mb-12 fade-in-up max-w-7xl mx-auto" style={{ transitionDelay: '100ms' }}>
                                        <RichTextEditor contentKey="opportunityProse" value={textContent.opportunityProse} onSave={handleContentSave} className="text-left" />
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                                        <div className="bg-white border border-gray-200 p-8 rounded-lg shadow-lg fade-in-up text-left"><RichTextEditor contentKey="marketRationaleTitle" value={textContent.marketRationaleTitle} onSave={handleContentSave} className="text-2xl font-bold text-[#F97316] mb-4 text-left" /><RichTextEditor contentKey="marketRationale" value={textContent.marketRationale} onSave={handleContentSave} className="text-gray-600 mb-4" /></div>
                                        <div className="bg-white border border-gray-200 p-8 rounded-lg shadow-lg fade-in-up text-left"><RichTextEditor contentKey="financialOfferTitle" value={textContent.financialOfferTitle} onSave={handleContentSave} className="text-2xl font-bold text-[#F97316] mb-4 text-left" /><RichTextEditor contentKey="financialOffer" value={textContent.financialOffer} onSave={handleContentSave} className="text-gray-600 mb-4" /></div>
                                        <div className="bg-white border border-gray-200 p-8 rounded-lg shadow-lg fade-in-up text-left"><RichTextEditor contentKey="businessSupportTitle" value={textContent.businessSupportTitle} onSave={handleContentSave} className="text-2xl font-bold text-[#F97316] mb-4 text-left" /><RichTextEditor contentKey="businessSupport" value={textContent.businessSupport} onSave={handleContentSave} className="text-gray-600 mb-4" /></div>
                                        <div className="bg-white border border-gray-200 p-8 rounded-lg shadow-lg fade-in-up text-left"><RichTextEditor contentKey="valueRealisationTitle" value={textContent.valueRealisationTitle} onSave={handleContentSave} className="text-2xl font-bold text-[#F97316] mb-4 text-left" /><RichTextEditor contentKey="valueRealisation" value={textContent.valueRealisation} onSave={handleContentSave} className="text-gray-600 mb-4" /></div>
                                    </div>
                                </Section>
                                
                                <InteractiveFinancials />
                                
                                <ShareholdingCalculator />

                                <Section id="team" className="container mx-auto px-4 sm:px-6 lg:px-8">
                                    <div className="text-center mb-16">
                                        <RichTextEditor contentKey="teamTitle" value={textContent.teamTitle} onSave={handleContentSave} className="text-4xl md:text-5xl font-bold fade-in-up text-center" />
                                        {isGlobalEditMode && (
                                            <button onClick={() => setIsTeamModalOpen(true)} className="ml-4 bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors inline-block align-middle">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                            </button>
                                        )}
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
                                        {leadershipTeam.map((member, index) => (
                                        <div key={member.id} className="text-center fade-in-up" style={{ transitionDelay: `${100 * (index + 1)}ms` }}><div className="w-28 h-28 bg-gray-200 border-2 border-gray-300 rounded-full mx-auto flex items-center justify-center mb-4"><span className="text-4xl text-gray-400 font-bold">{member.name.split(' ').map(n => n[0]).join('')}</span></div><h4 className="font-bold text-xl">{member.name}</h4><p className="text-md text-[#F97316] mb-2">{member.role}</p><p className="text-gray-600 max-w-xs mx-auto text-sm">{member.bio}</p></div>
                                        ))}
                                    </div>
                                </Section>
                                
                                <Section id="supporting-documents" className="container mx-auto px-4 sm:px-6 lg:px-8">
                                    <div className="text-center mb-16">
                                        <RichTextEditor contentKey="supportingDocsTitle" value={textContent.supportingDocsTitle} onSave={handleContentSave} className="text-4xl md:text-5xl font-bold text-center fade-in-up" />
                                        {isGlobalEditMode && (
                                            <button onClick={() => setIsDocsModalOpen(true)} className="ml-4 bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors inline-block align-middle">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                            </button>
                                        )}
                                    </div>
                                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                                        {supportingDocs.map(doc => (
                                            <div key={doc.id} className="bg-white border border-gray-200 p-6 rounded-lg shadow-sm flex flex-col text-center">
                                                <h3 className="text-xl font-bold mb-2">{doc.title}</h3>
                                                <p className="text-gray-600 text-sm mb-4 flex-grow">{doc.description}</p>
                                                <a href={doc.url} target="_blank" rel="noopener noreferrer" className={`mt-auto text-white text-center font-bold py-2 px-4 rounded-md transition-colors ${doc.url && doc.url !== '#' ? 'bg-orange-500 hover:bg-orange-600' : 'bg-gray-400 cursor-not-allowed'}`}>View Document</a>
                                            </div>
                                        ))}
                                    </div>
                                </Section>
                            </main>
                            <footer className="border-t border-gray-200 mt-24">
                                <div className="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500">
                                    <p>Project Synergy &copy; 2025. All information is confidential.</p>
                                </div>
                            </footer>
                        </div>
                        {/* Modals */}
                        <TimelineEditorModal isOpen={isTimelineModalOpen} onClose={() => setIsTimelineModalOpen(false)} onSave={handleSaveTimeline} data={timelineData} />
                        <TeamEditorModal isOpen={isTeamModalOpen} onClose={() => setIsTeamModalOpen(false)} onSave={handleSaveTeam} data={leadershipTeam} />
                        <SupportingDocsEditorModal isOpen={isDocsModalOpen} onClose={() => setIsDocsModalOpen(false)} onSave={handleSaveDocs} data={supportingDocs} />
                        {isEditAuthVisible && (
                            <EditModePasswordGate 
                                onAuthenticated={handleEditAuthSuccess}
                                onCancel={() => setIsEditAuthVisible(false)}
                            />
                        )}
                    </div>
                </AppContext.Provider>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
